<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vida Plena - Assistente Di√°rio</title>
    <style>
        /* --- CSS: O Visual do Site --- */
        
        :root {
            /* Cores Acess√≠veis e Calmas */
            --cor-fundo: #F0F4F8;       /* Cinza azulado muito claro */
            --cor-primaria: #0056b3;    /* Azul forte para boa leitura */
            --cor-secundaria: #0288d1;  /* Azul m√©dio para bot√µes */
            --cor-texto: #1a1a1a;       /* Preto suave, alto contraste */
            --cor-branco: #ffffff;
            --cor-sucesso: #2e7d32;     /* Verde escuro */
            --cor-alerta: #d32f2f;      /* Vermelho escuro */
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            font-size: 18px; /* Fonte base aumentada para idosos */
            line-height: 1.6;
        }

        /* Container Principal */
        .app-container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--cor-branco);
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            padding-bottom: 80px; /* Espa√ßo para navega√ß√£o se houver */
        }

        /* Cabe√ßalho - Ajustado para o Logo */
        header {
            background-color: var(--cor-primaria);
            color: var(--cor-branco);
            padding: 20px;
            text-align: center;
            font-size: 1.4rem;
            font-weight: bold;
            
            /* Adicionado para centralizar logo e texto */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        /* Estilos do Logo */
        #logo-app {
            height: 40px; 
            width: auto;
            border-radius: 5px;
        }

        /* Telas (Sections) */
        .tela {
            display: none; /* Esconde todas as telas por padr√£o */
            padding: 20px;
            animation: fadeIn 0.5s;
        }

        .tela.ativa {
            display: block; /* Mostra apenas a tela ativa */
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Tipografia e Hierarquia */
        h2 {
            color: var(--cor-primaria);
            border-bottom: 2px solid var(--cor-fundo);
            padding-bottom: 10px;
            margin-top: 0;
        }

        p { margin-bottom: 20px; }

        /* Formul√°rios e Inputs Gigantes */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input, select, textarea {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            margin-bottom: 20px;
            border: 2px solid #ccc;
            border-radius: 8px;
        }

        input:focus {
            border-color: var(--cor-primaria);
            /* Importante: Foco vis√≠vel para acessibilidade de teclado */
            outline: 3px solid var(--cor-secundaria); 
            outline-offset: 2px;
        }

        /* Bot√µes Acess√≠veis */
        .btn {
            display: block;
            width: 100%;
            padding: 18px;
            background-color: var(--cor-secundaria);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 15px;
            text-align: center;
            transition: background 0.3s;
        }

        /* Foco e Hover no Bot√£o */
        .btn:hover, .btn:focus {
            background-color: var(--cor-primaria);
            outline: none;
        }

        .btn-voltar {
            background-color: #757575;
        }

        .btn-grande-menu {
            padding: 30px;
            margin-bottom: 20px;
            font-size: 1.4rem;
            background-color: var(--cor-primaria);
            border-left: 10px solid var(--cor-secundaria);
            text-align: left;
        }

        /* Listagem de Rem√©dios (Cards) */
        .lista-item {
            background-color: #eeffff;
            border: 1px solid #b3e5fc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .lista-item strong {
            font-size: 1.3rem;
            display: block;
            color: var(--cor-primaria);
        }

        /* Bot√£o Remover (Mais claro e acess√≠vel) */
        .btn-remover {
            background-color: var(--cor-alerta);
            width: auto;
            padding: 10px 15px; /* Aumentado a √°rea de clique */
            margin: 0;
            font-size: 1rem;
        }

    </style>
</head>
<body>

<div class="app-container">
    <header id="header-title">
        <img src="logo-vida-plena.png" alt="Logo Vida Plena - Assistente Di√°rio" id="logo-app" onerror="this.style.display='none'">
        Vida Plena
    </header>

    <section id="tela-login" class="tela ativa">
        <h2>Bem-vindo(a)</h2>
        <p>Para come√ßar, digite seu nome para entrar no sistema.</p>
        <form id="form-login">
            <label for="nome-usuario">Qual √© o seu nome?</label>
            <input type="text" id="nome-usuario" placeholder="Ex: Maria Silva" required>
            <button type="submit" class="btn">Entrar no Sistema</button>
        </form>
    </section>

    <section id="tela-home" class="tela">
        <h2 id="saudacao-home">Ol√°!</h2>
        <p>O que voc√™ deseja fazer agora?</p>
        
        <button onclick="navegarPara('tela-remedios')" class="btn btn-grande-menu">
            üíä Meus Rem√©dios
        </button>
        
        <button onclick="navegarPara('tela-perfil')" class="btn btn-grande-menu">
            üë§ Meu Perfil e Dados
        </button>
        
        <button onclick="alert('Funcionalidade de Emerg√™ncia: Ligando para contato de seguran√ßa...')" class="btn btn-grande-menu" style="background-color: #d32f2f; border-left-color: #b71c1c;">
            üÜò Bot√£o de Emerg√™ncia
        </button>
        
        <button onclick="sairDoSistema()" class="btn btn-voltar" style="margin-top: 30px;">Sair</button>
    </section>

    <section id="tela-remedios" class="tela">
        <h2>Meus Rem√©dios</h2>
        <p>Cadastre aqui os rem√©dios que precisa tomar.</p>

        <form id="form-remedio">
            <label for="nome-remedio">Nome do Rem√©dio:</label>
            <input type="text" id="nome-remedio" placeholder="Ex: Losartana" required>
            
            <label for="horario-remedio">Hor√°rio:</label>
            <input type="time" id="horario-remedio" required>
            
            <button type="submit" class="btn" style="background-color: var(--cor-sucesso);">Adicionar Rem√©dio</button>
        </form>

        <hr>
        <h3>Lista do dia:</h3>
        <div id="lista-remedios-container">
            <p style="font-style: italic; color: #666;">Nenhum rem√©dio cadastrado ainda.</p>
        </div>

        <button onclick="navegarPara('tela-home')" class="btn btn-voltar">Voltar ao In√≠cio</button>
    </section>

    <section id="tela-perfil" class="tela">
        <h2>Meus Dados</h2>
        <p>Aqui est√£o suas informa√ß√µes pessoais.</p>
        
        <div style="background: #eee; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
            <label>Nome Completo:</label>
            <p id="perfil-nome" style="font-size: 1.4rem; font-weight: bold;">-</p>
            
            <label>Tipo Sangu√≠neo (Exemplo):</label>
            <p>O+</p>
        </div>

        <button onclick="navegarPara('tela-home')" class="btn btn-voltar">Voltar ao In√≠cio</button>
    </section>

</div>

<script>
    /* --- JAVASCRIPT: A L√≥gica do Sistema (Com Notifica√ß√µes) --- */

    // Vari√°veis Globais
    const inputNome = document.getElementById('nome-usuario');
    const listaRemediosContainer = document.getElementById('lista-remedios-container');
    
    // Objeto para rastrear os timers de notifica√ß√£o (Para evitar duplicidade ou cancelar)
    const timersNotificacao = {}; 
    
    // --- NOVO: Fun√ß√£o para solicitar permiss√£o de Notifica√ß√£o ---
    function pedirPermissaoNotificacao() {
        if (!("Notification" in window)) {
            console.error("Este navegador n√£o suporta notifica√ß√µes de desktop.");
            return;
        }
        
        if (Notification.permission !== 'granted') {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    console.log("Permiss√£o de notifica√ß√£o concedida!");
                } else {
                    console.warn("Permiss√£o de notifica√ß√£o negada.");
                }
            });
        }
    }
    // -----------------------------------------------------------

    // Ao carregar a p√°gina, verifica se j√° tem usu√°rio salvo
    window.onload = function() {
        const usuarioSalvo = localStorage.getItem('usuarioIdoso');
        if (usuarioSalvo) {
            entrarNoSistema(usuarioSalvo);
        }
        pedirPermissaoNotificacao(); // <-- NOVO: Pede a permiss√£o
        carregarRemedios();
    };

    // Fun√ß√£o de Login Simulado
    document.getElementById('form-login').addEventListener('submit', function(e) {
        e.preventDefault(); 
        const nome = inputNome.value;
        if (nome) {
            localStorage.setItem('usuarioIdoso', nome);
            entrarNoSistema(nome);
        }
    });

    function entrarNoSistema(nome) {
        document.getElementById('saudacao-home').innerText = "Ol√°, " + nome + "!";
        document.getElementById('perfil-nome').innerText = nome;
        navegarPara('tela-home');
    }

    function sairDoSistema() {
        localStorage.removeItem('usuarioIdoso');
        // Ao sair, limpa todos os agendamentos pendentes
        Object.keys(timersNotificacao).forEach(id => clearTimeout(timersNotificacao[id])); 
        location.reload(); 
    }

    // Sistema de Navega√ß√£o (Troca de Telas)
    function navegarPara(idTela) {
        const telas = document.querySelectorAll('.tela');
        telas.forEach(tela => tela.classList.remove('ativa'));
        document.getElementById(idTela).classList.add('ativa');
        window.scrollTo(0, 0);
    }
    
    // --- NOVO: Fun√ß√£o para agendar e disparar a notifica√ß√£o ---
    function agendarNotificacao(idRemedio, nomeRemedio, horario) {
        // Limpa o timer anterior para este ID, se houver
        if (timersNotificacao[idRemedio]) {
            clearTimeout(timersNotificacao[idRemedio]);
        }

        if (Notification.permission !== 'granted') return;

        const agora = new Date();
        const [h, m] = horario.split(':').map(Number);
        
        // Data/Hora atual para o rem√©dio
        const horaDoRemedioHoje = new Date(agora.getFullYear(), agora.getMonth(), agora.getDate(), h, m, 0);

        let tempoAteOAlerta;
        
        if (horaDoRemedioHoje > agora) {
            // Se a hora √© no futuro (ainda hoje)
            tempoAteOAlerta = horaDoRemedioHoje.getTime() - agora.getTime();
        } else {
            // Se a hora j√° passou (agenda para amanh√£)
            const horaDoRemedioAmanha = new Date(horaDoRemedioHoje);
            horaDoRemedioAmanha.setDate(horaDoRemedioAmanha.getDate() + 1); 
            tempoAteOAlerta = horaDoRemedioAmanha.getTime() - agora.getTime();
        }
        
        // 2. Agenda a execu√ß√£o
        const timerId = setTimeout(() => {
            new Notification("üíä Hora do Rem√©dio!", {
                body: `√â hora de tomar: ${nomeRemedio} (${horario})`,
                icon: 'logo-vida-plena.png', // Tente usar o logo
                vibrate: [200, 100, 200]
            });
            
            // Re-agenda para o dia seguinte (recorr√™ncia)
            // Se a notifica√ß√£o disparou, o pr√≥ximo alerta √© daqui a 24 horas
            setTimeout(() => {
                agendarNotificacao(idRemedio, nomeRemedio, horario);
            }, 24 * 60 * 60 * 1000); 

        }, tempoAteOAlerta);
        
        timersNotificacao[idRemedio] = timerId; // Salva o ID do timer
    }
    // -----------------------------------------------------------


    // L√≥gica de Rem√©dios (Adicionar e Listar) - ATUALIZADA
    document.getElementById('form-remedio').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const nomeRemedio = document.getElementById('nome-remedio').value;
        const horarioRemedio = document.getElementById('horario-remedio').value;
        const novoId = Date.now(); // Cria um ID √∫nico
        
        const novoRemedio = { nome: nomeRemedio, horario: horarioRemedio, id: novoId };
        
        // Agendar a notifica√ß√£o (NOVO)
        agendarNotificacao(novoId, nomeRemedio, horarioRemedio);

        // Salva no LocalStorage
        let remedios = JSON.parse(localStorage.getItem('listaRemedios') || '[]');
        remedios.push(novoRemedio);
        localStorage.setItem('listaRemedios', JSON.stringify(remedios));

        // Limpa formul√°rio e recarrega lista
        document.getElementById('form-remedio').reset();
        carregarRemedios();
        alert('Rem√©dio adicionado com sucesso e notifica√ß√£o agendada!');
    });

    function carregarRemedios() {
        const remedios = JSON.parse(localStorage.getItem('listaRemedios') || '[]');
        listaRemediosContainer.innerHTML = ''; 
        
        // 1. Limpa todos os agendamentos anteriores antes de recarregar
        Object.keys(timersNotificacao).forEach(id => clearTimeout(timersNotificacao[id])); 

        if (remedios.length === 0) {
            listaRemediosContainer.innerHTML = '<p style="font-style: italic; color: #666;">Nenhum rem√©dio cadastrado ainda.</p>';
            return;
        }

        remedios.sort((a, b) => a.horario.localeCompare(b.horario)); 

        remedios.forEach(remedio => {
            // Re-agenda a notifica√ß√£o ao carregar a lista (essencial ao abrir o site)
            agendarNotificacao(remedio.id, remedio.nome, remedio.horario); // <-- NOVO

            const div = document.createElement('div');
            div.className = 'lista-item';
            div.innerHTML = `
                <div>
                    <strong>${remedio.nome}</strong>
                    <span>Hor√°rio: ${remedio.horario}</span>
                </div>
                <button 
                    onclick="removerRemedio(${remedio.id})" 
                    class="btn btn-remover"
                    aria-label="Remover Rem√©dio ${remedio.nome}"
                >Remover</button>
            `;
            listaRemediosContainer.appendChild(div);
        });
    }

    function removerRemedio(id) {
        if(confirm('Deseja realmente excluir este rem√©dio?')) {
            // Limpa o agendamento de notifica√ß√£o associado a este rem√©dio
            clearTimeout(timersNotificacao[id]); 
            delete timersNotificacao[id]; // Remove do objeto de rastreamento
            
            let remedios = JSON.parse(localStorage.getItem('listaRemedios') || '[]');
            remedios = remedios.filter(r => r.id !== id);
            localStorage.setItem('listaRemedios', JSON.stringify(remedios));
            
            carregarRemedios();
        }
    }
</script>

</body>
</html>

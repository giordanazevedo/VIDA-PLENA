<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vida Plena - Assistente Di√°rio</title>
    <style>
        /* --- CSS: O Visual do Site --- */
        
        :root {
            /* Cores Acess√≠veis e Calmas */
            --cor-fundo: #F0F4F8;       
            --cor-primaria: #0056b3;    
            --cor-secundaria: #0288d1;  
            --cor-texto: #1a1a1a;       
            --cor-sucesso: #2e7d32;     
            --cor-atraso: #d32f2f;      
            --cor-alerta: #d32f2f;      
            --cor-branco: #ffffff;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            font-size: 18px; 
            line-height: 1.6;
        }

        /* Container Principal */
        .app-container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--cor-branco);
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            padding-bottom: 80px; 
        }

        /* Cabe√ßalho - AUMENTADO O ESPA√áAMENTO VERTICAL */
        header {
            background-color: var(--cor-primaria);
            color: var(--cor-branco);
            padding: 40px 30px; /* AUMENTADO PARA 25px */
            font-size: 1.4rem;
            font-weight: bold;
            
            display: flex;
            align-items: center;
            justify-content: space-between; 
            
            position: relative; 
        }
        
        /* Estilo para centralizar o texto "Vida Plena" */
        #header-title span {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap; 
        }
        
        /* Seus estilos para o logo */
#logo-app {
    height: 40px; /* Altere este valor para definir o tamanho da sua nova imagem */
    width: auto;
    border-radius: 5px;
}
        }
        
        /* √çcone de Notifica√ß√£o (Sino) */
        #notificacao-icon {
            position: absolute;
            right: 20px; 
            top: 50%; 
            transform: translateY(-50%); 
            font-size: 1.6rem;
            cursor: pointer; 
            color: var(--cor-branco);
            display: none; 
            line-height: 1; 
        }

        .badge {
            position: absolute;
            top: -8px; 
            right: -10px;
            background-color: var(--cor-atraso); 
            color: var(--cor-branco);
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.7rem;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
            z-index: 10; 
        }
        
        /* Telas (Sections) */
        .tela {
            display: none; 
            padding: 20px;
            animation: fadeIn 0.5s;
        }

        .tela.ativa {
            display: block; 
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Tipografia e Hierarquia */
        h2 {
            color: var(--cor-primaria);
            border-bottom: 2px solid var(--cor-fundo);
            padding-bottom: 10px;
            margin-top: 0;
        }

        p { margin-bottom: 20px; }

        /* Formul√°rios e Inputs Gigantes */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input, select, textarea {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            margin-bottom: 20px;
            border: 2px solid #ccc;
            border-radius: 8px;
        }

        input:focus {
            border-color: var(--cor-primaria);
            outline: 3px solid var(--cor-secundaria); 
            outline-offset: 2px;
        }

        /* Bot√µes Acess√≠veis */
        .btn {
            display: block;
            width: 100%;
            padding: 18px;
            background-color: var(--cor-secundaria);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 15px;
            text-align: center;
            transition: background 0.3s;
        }

        /* Foco e Hover no Bot√£o */
        .btn:hover, .btn:focus {
            background-color: var(--cor-primaria);
            outline: none;
        }

        .btn-voltar {
            background-color: #757575;
        }

        .btn-grande-menu {
            padding: 30px;
            margin-bottom: 20px;
            font-size: 1.4rem;
            background-color: var(--cor-primaria);
            border-left: 10px solid var(--cor-secundaria);
            text-align: left;
        }

        /* Listagem de Rem√©dios (Cards) */
        .lista-item {
            background-color: #eeffff;
            border: 1px solid #b3e5fc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .lista-item-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .lista-item strong {
            font-size: 1.3rem;
            display: block;
            color: var(--cor-primaria);
        }

        /* ESTILOS PARA REM√âDIO TOMADO */
        .lista-item.tomado {
            background-color: #e0e0e0;
            opacity: 0.6;
            border-color: #9e9e9e;
            transition: opacity 0.3s;
        }

        .lista-item.tomado strong,
        .lista-item.tomado span {
            text-decoration: line-through;
        }

        /* Bot√£o Remover (Mais claro e acess√≠vel) */
        .btn-remover {
            background-color: var(--cor-alerta);
            width: auto;
            padding: 10px 15px; 
            margin: 0;
            font-size: 1rem;
        }
        
        /* Checkbox grande */
        .checkbox-grande {
            width: 30px;
            height: 30px;
            min-width: 30px;
            min-height: 30px;
            cursor: pointer;
        }
        
        /* Estilo espec√≠fico para o link de emerg√™ncia na nova tela */
        #link-emergencia {
            display: block;
            width: 100%;
            padding: 18px;
            background-color: var(--cor-atraso) !important;
            margin-top: 15px;
            text-decoration: none;
        }

    </style>
</head>
<body>

<div class="app-container">
    <header id="header-title">
        <img src="conecta.png" alt="Logo do Site" id="logo-app"> 

        <span>Vida Plena</span> 
        
        <div id="notificacao-icon" onclick="navegarPara('tela-atrasos')" title="Clique para ver os rem√©dios em atraso">
            üîî<span id="contador-atraso" class="badge">0</span>
        </div>
    </header>

    <section id="tela-login" class="tela ativa">
        <h2>Bem-vindo(a)</h2>
        <p>Para come√ßar, digite seu nome para entrar no sistema.</p>
        <form id="form-login">
            <label for="nome-usuario">Qual √© o seu nome?</label>
            <input type="text" id="nome-usuario" placeholder="Ex: Maria Silva" required>
            <button type="submit" class="btn">Entrar no Sistema</button>
        </form>
    </section>

    <section id="tela-home" class="tela">
        <h2 id="saudacao-home">Ol√°!</h2>
        <p>O que voc√™ deseja fazer agora?</p>
        
        <button onclick="navegarPara('tela-remedios')" class="btn btn-grande-menu">
            üíä Meus Rem√©dios
        </button>
        
        <button onclick="navegarPara('tela-calendario')" class="btn btn-grande-menu">
            üìÖ Programa√ß√£o do Centro de Conviv√™ncia
        </button>
        
        <button onclick="navegarPara('tela-perfil')" class="btn btn-grande-menu">
            üë§ Meu Perfil e Dados
        </button>
        
        <button onclick="navegarPara('tela-emergencia')" class="btn btn-grande-menu" style="background-color: var(--cor-atraso); border-left-color: #b71c1c;">
            üÜò Bot√£o de Emerg√™ncia
        </button>
        
        <button onclick="sairDoSistema()" class="btn btn-voltar" style="margin-top: 30px;">Sair</button>
    </section>

    <section id="tela-remedios" class="tela">
        <h2>Meus Rem√©dios</h2>
        <p>Cadastre aqui os rem√©dios que precisa tomar.</p>

        <form id="form-remedio">
            <label for="nome-remedio">Nome do Rem√©dio:</label>
            <input type="text" id="nome-remedio" placeholder="Ex: Losartana" required>
            
            <label for="intervalo-remedio">Tomar a cada (horas):</label>
            <select id="intervalo-remedio" required>
                <option value="">Selecione o intervalo</option>
                <option value="24">24 horas (1 vez ao dia)</option>
                <option value="12">12 horas (2 vezes ao dia)</option>
                <option value="8">8 horas (3 vezes ao dia)</option>
                <option value="6">6 horas (4 vezes ao dia)</option>
            </select>
            
            <label for="horario-remedio">Primeiro Hor√°rio de Hoje (24h):</label>
            <input type="time" id="horario-remedio" required>
            
            <button type="submit" class="btn" style="background-color: var(--cor-sucesso);">Adicionar Rem√©dio</button>
        </form>

        <hr>
        <h3>Lista de Rem√©dios Agendados:</h3>
        <div id="lista-remedios-container">
            <p style="font-style: italic; color: #666;">Nenhum rem√©dio cadastrado ainda.</p>
        </div>

        <button onclick="navegarPara('tela-home')" class="btn btn-voltar">Voltar ao In√≠cio</button>
    </section>

    <section id="tela-calendario" class="tela">
        <h2>üìÖ Agenda do Centro de Conviv√™ncia</h2>
        <p>Confira a programa√ß√£o semanal de atividades no per√≠odo da manh√£ (08:00h √†s 11:00h).</p>
        <div id="calendario-container">
            </div>
        <button onclick="navegarPara('tela-home')" class="btn btn-voltar">Voltar ao In√≠cio</button>
    </section>

    <section id="tela-atrasos" class="tela">
        <h2>üíä Rem√©dios em Atraso</h2>
        <p>Estes s√£o os rem√©dios que passaram do hor√°rio e ainda n√£o foram marcados como tomados:</p>
        
        <div id="lista-atrasos-container">
            </div>

        <button onclick="navegarPara('tela-home')" class="btn btn-voltar">Voltar ao In√≠cio</button>
        <button onclick="navegarPara('tela-remedios')" class="btn" style="margin-top: 10px;">Ver Todos os Rem√©dios</button>
    </section>

    <section id="tela-emergencia" class="tela">
        <h2>üÜò Contato de Emerg√™ncia</h2>
        <p>Cadastre aqui o nome e telefone da pessoa que deve ser contatada em caso de emerg√™ncia.</p>

        <form id="form-contato-emergencia">
            <label for="nome-emergencia">Nome do Contato:</label>
            <input type="text" id="nome-emergencia" placeholder="Ex: Jo√£o Filho" required>
            
            <label for="telefone-emergencia">Telefone (Somente n√∫meros, com DDD):</label>
            <input type="tel" id="telefone-emergencia" placeholder="Ex: 86999887766" required pattern="[0-9]{10,15}">
            
            <button type="submit" class="btn" style="background-color: var(--cor-sucesso);">Salvar Contato</button>
        </form>

        <hr>
        
        <h3>Contato Atual:</h3>
        <div id="dados-emergencia" style="background: #fff3f3; padding: 15px; border-radius: 8px; border: 1px solid var(--cor-atraso); margin-bottom: 20px;">
            <p id="contato-nome">Nenhum contato salvo.</p>
            <a href="#" id="link-emergencia" class="btn" style="background-color: var(--cor-atraso); display: none;">Ligar para: <span id="contato-telefone-display"></span></a>
        </div>
        
        <button onclick="navegarPara('tela-home')" class="btn btn-voltar">Voltar ao In√≠cio</button>
    </section>

    <section id="tela-perfil" class="tela">
        <h2>Meus Dados</h2>
        <p>Aqui voc√™ pode visualizar e editar suas informa√ß√µes pessoais.</p>
        
        <div style="background: #eee; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
            <form id="form-perfil-edicao">
                <label for="input-perfil-nome">Nome Completo:</label>
                <input type="text" id="input-perfil-nome" required style="font-size: 1.2rem; font-weight: bold; margin-bottom: 10px;">
                
                <label>Tipo Sangu√≠neo (Exemplo Fixo):</label>
                <p>O+</p>
                
                <button type="submit" class="btn" style="background-color: var(--cor-sucesso); margin-top: 15px;">Salvar Altera√ß√µes</button>
            </form>
        </div>

        <button onclick="navegarPara('tela-home')" class="btn btn-voltar">Voltar ao In√≠cio</button>
    </section>

</div>

<script>
    /* --- JAVASCRIPT: A L√≥gica do Sistema --- */

    const inputNome = document.getElementById('nome-usuario');
    const listaRemediosContainer = document.getElementById('lista-remedios-container');
    const inputIntervalo = document.getElementById('intervalo-remedio'); 
    const timersNotificacao = {}; 
    
    // VARI√ÅVEIS PARA EMERG√äNCIA
    const formEmergencia = document.getElementById('form-contato-emergencia');
    const nomeEmergencia = document.getElementById('nome-emergencia');
    const telefoneEmergencia = document.getElementById('telefone-emergencia');
    const dadosEmergencia = document.getElementById('dados-emergencia');
    const linkEmergencia = document.getElementById('link-emergencia');
    const contatoNomeDisplay = document.getElementById('contato-nome');
    const contatoTelefoneDisplay = document.getElementById('contato-telefone-display');
    
    // VARI√ÅVEIS PARA EDI√á√ÉO DE PERFIL
    const formPerfilEdicao = document.getElementById('form-perfil-edicao');
    const inputPerfilNome = document.getElementById('input-perfil-nome');

    
    // DADOS EST√ÅTICOS DO CALEND√ÅRIO
    const agendaCentro = {
        'Segunda-feira': [
            { horario: '09:00', atividade: 'Gin√°stica Suave' },
            { horario: '10:30', atividade: 'Oficina de Artesanato' }
        ],
        'Ter√ßa-feira': [
            { horario: '09:30', atividade: 'Ioga e Medita√ß√£o' }
        ],
        'Quarta-feira': [
            { horario: '10:00', atividade: 'Dan√ßa S√™nior' }
        ],
        'Quinta-feira': [
            { horario: '09:00', atividade: 'Grupo de Caminhada' }
        ],
        'Sexta-feira': [
            { horario: '10:30', atividade: 'M√∫sica e Coral' }
        ],
        'S√°bado': [],
        'Domingo': []
    };

    // FUN√á√ïES DE PERFIL E LOGIN
    function pedirPermissaoNotificacao() {
        if (!("Notification" in window)) {
            console.error("Este navegador n√£o suporta notifica√ß√µes de desktop.");
            return;
        }
        
        if (Notification.permission !== 'granted') {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    console.log("Permiss√£o de notifica√ß√£o concedida!");
                } else {
                    console.warn("Permiss√£o de notifica√ß√£o negada.");
                }
            });
        }
    }
    
    // Fun√ß√£o para carregar dados do perfil na tela de edi√ß√£o
    function carregarPerfilDados() {
        const nome = localStorage.getItem('usuarioIdoso');
        if (inputPerfilNome) {
            inputPerfilNome.value = nome || ''; 
        }
    }
    
    // Fun√ß√£o para salvar dados do perfil
    if (formPerfilEdicao) {
        formPerfilEdicao.addEventListener('submit', function(e) {
            e.preventDefault();
            const novoNome = inputPerfilNome.value;
            if (novoNome) {
                localStorage.setItem('usuarioIdoso', novoNome);
                document.getElementById('saudacao-home').innerText = "Ol√°, " + novoNome + "!";
                alert('Nome atualizado com sucesso!');
            }
        });
    }


    window.onload = function() {
        const usuarioSalvo = localStorage.getItem('usuarioIdoso');
        if (usuarioSalvo) {
            entrarNoSistema(usuarioSalvo);
        }
        pedirPermissaoNotificacao(); 
        carregarRemedios();
        verificarRemediosAtrasados();
        setInterval(verificarRemediosAtrasados, 60000); 
        
        if (document.getElementById('tela-emergencia')) {
            carregarContatoEmergencia(); 
        }
    };

    document.getElementById('form-login').addEventListener('submit', function(e) {
        e.preventDefault(); 
        const nome = inputNome.value;
        if (nome) {
            localStorage.setItem('usuarioIdoso', nome);
            entrarNoSistema(nome);
        }
    });

    function entrarNoSistema(nome) {
        document.getElementById('saudacao-home').innerText = "Ol√°, " + nome + "!";
        navegarPara('tela-home');
    }

    function sairDoSistema() {
        localStorage.removeItem('usuarioIdoso');
        Object.keys(timersNotificacao).forEach(id => clearTimeout(timersNotificacao[id])); 
        location.reload(); 
    }

    // FUN√á√ÉO DE NAVEGA√á√ÉO
    function navegarPara(idTela) {
        const telas = document.querySelectorAll('.tela');
        telas.forEach(tela => tela.classList.remove('ativa'));
        document.getElementById(idTela).classList.add('ativa');
        window.scrollTo(0, 0);

        if (idTela === 'tela-atrasos') {
            carregarRemediosAtrasados();
        } else if (idTela === 'tela-emergencia') {
            carregarContatoEmergencia(); 
        } else if (idTela === 'tela-calendario') {
            carregarCalendario();
        } else if (idTela === 'tela-perfil') {
            carregarPerfilDados();
        }
    }
    
    // FUN√á√ÉO PARA CARREGAR O CALEND√ÅRIO
    function carregarCalendario() {
        const container = document.getElementById('calendario-container');
        container.innerHTML = '';
        
        const diasDaSemana = Object.keys(agendaCentro);

        diasDaSemana.forEach(dia => {
            const atividades = agendaCentro[dia];
            
            const titulo = document.createElement('h3');
            titulo.style.color = 'var(--cor-secundaria)';
            titulo.style.marginTop = '20px';
            titulo.innerText = dia;
            container.appendChild(titulo);

            if (atividades.length === 0) {
                const p = document.createElement('p');
                p.style.fontStyle = 'italic';
                p.style.color = '#666';
                p.innerText = 'Nenhuma atividade programada.';
                container.appendChild(p);
                return;
            }

            const ul = document.createElement('ul');
            ul.style.listStyleType = 'none';
            ul.style.paddingLeft = '0';
            ul.style.marginBottom = '30px';

            atividades.forEach(item => {
                const li = document.createElement('li');
                li.style.background = '#e6f2ff';
                li.style.padding = '10px';
                li.style.marginBottom = '5px';
                li.style.borderRadius = '5px';

                li.innerHTML = `
                    <span style="font-weight: bold; color: var(--cor-primaria);">${item.horario}</span>: ${item.atividade}
                `;
                ul.appendChild(li);
            });
            container.appendChild(ul);
        });
    }

    // FUN√á√ïES DE EMERG√äNCIA
    function carregarContatoEmergencia() {
        const contato = JSON.parse(localStorage.getItem('contatoEmergencia') || 'null');
        
        if (contato) {
            contatoNomeDisplay.innerText = `Nome: ${contato.nome}`;
            
            const telFormatado = contato.telefone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            contatoTelefoneDisplay.innerText = telFormatado;
            
            linkEmergencia.href = `tel:${contato.telefone}`; 
            linkEmergencia.style.display = 'block';
            
            if (nomeEmergencia) nomeEmergencia.value = contato.nome;
            if (telefoneEmergencia) telefoneEmergencia.value = contato.telefone;

        } else {
            contatoNomeDisplay.innerText = 'Nenhum contato salvo. Por favor, cadastre um.';
            contatoTelefoneDisplay.innerText = '';
            linkEmergencia.style.display = 'none';
        }
    }
    
    if (formEmergencia) {
        formEmergencia.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const novoContato = {
                nome: nomeEmergencia.value,
                telefone: telefoneEmergencia.value.replace(/[^0-9]/g, '')
            };
            
            localStorage.setItem('contatoEmergencia', JSON.stringify(novoContato));
            carregarContatoEmergencia();
            alert('Contato de emerg√™ncia salvo com sucesso!');
        });
    }
    
    // FUN√á√ïES DE AGENDAMENTO (REMEDIOS)
    function calcularPrimeiraDose(horario, intervaloHoras) {
        const agora = new Date();
        const [h, m] = horario.split(':').map(Number);
        
        let proximaDose = new Date(agora.getFullYear(), agora.getMonth(), agora.getDate(), h, m, 0);

        while (proximaDose < agora) {
            proximaDose.setTime(proximaDose.getTime() + (intervaloHoras * 60 * 60 * 1000));
        }
        return proximaDose.toISOString(); 
    }
    
    function agendarNotificacao(remedio) {
        if (timersNotificacao[remedio.id]) {
            clearTimeout(timersNotificacao[remedio.id]);
        }

        if (Notification.permission !== 'granted') return;
        
        const proximaDose = new Date(remedio.proximaDose);
        const agora = new Date();
        
        if (proximaDose > agora) {
            const tempoAteOAlerta = proximaDose.getTime() - agora.getTime();
            
            const timerId = setTimeout(() => {
                new Notification("üíä Hora do Rem√©dio!", {
                    body: `√â hora de tomar: ${remedio.nome} (Pr√≥xima dose agendada)`,
                    icon: 'notifications_70dp_EA3323_FILL0_wght400_GRAD0_opsz48.png', 
                });
                
                verificarRemediosAtrasados();

            }, tempoAteOAlerta);
            
            timersNotificacao[remedio.id] = timerId;
        } else {
             verificarRemediosAtrasados(); 
        }
    }
    
    function verificarRemediosAtrasados() {
        const remedios = JSON.parse(localStorage.getItem('listaRemedios') || '[]');
        const agora = new Date();
        let contadorAtraso = 0;
        
        remedios.forEach(remedio => {
            const proximaDose = new Date(remedio.proximaDose);
            
            const passouDoHorario = proximaDose < agora;
            
            if (passouDoHorario && !remedio.tomado) {
                contadorAtraso++;
            }
        });
        
        const iconContainer = document.getElementById('notificacao-icon');
        const badge = document.getElementById('contador-atraso');
        
        badge.innerText = contadorAtraso;
        
        if (contadorAtraso > 0) {
            iconContainer.style.display = 'block';
            iconContainer.title = `${contadorAtraso} rem√©dio(s) em atraso! Clique para conferir.`;
        } else {
            iconContainer.style.display = 'none';
        }
    }
    
    // L√≥gica de Adicionar Rem√©dio
    document.getElementById('form-remedio').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const nomeRemedio = document.getElementById('nome-remedio').value;
        const horarioRemedio = document.getElementById('horario-remedio').value;
        const intervaloHoras = parseInt(document.getElementById('intervalo-remedio').value); 
        const novoId = Date.now(); 
        
        const primeiraDose = calcularPrimeiraDose(horarioRemedio, intervaloHoras);
        
        const novoRemedio = { 
            nome: nomeRemedio, 
            intervalo: intervaloHoras, 
            proximaDose: primeiraDose, 
            id: novoId, 
            tomado: false 
        }; 
        
        agendarNotificacao(novoRemedio); 

        let remedios = JSON.parse(localStorage.getItem('listaRemedios') || '[]');
        remedios.push(novoRemedio);
        localStorage.setItem('listaRemedios', JSON.stringify(remedios));

        document.getElementById('form-remedio').reset();
        carregarRemedios();
        alert(`Rem√©dio adicionado com sucesso e primeira dose agendada para: ${new Date(primeiraDose).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`);
        verificarRemediosAtrasados();
    });
    
    function marcarComoTomado(id, checkbox) {
        let remedios = JSON.parse(localStorage.getItem('listaRemedios') || '[]');
        const remedioIndex = remedios.findIndex(r => r.id === id);
        
        if (remedioIndex !== -1) {
            const remedio = remedios[remedioIndex];
            remedio.tomado = checkbox.checked;
            
            if (checkbox.checked) {
                const agora = new Date();
                const proxima = new Date(agora.getTime() + (remedio.intervalo * 60 * 60 * 1000));
                remedio.proximaDose = proxima.toISOString();
                
                agendarNotificacao(remedio); 
            } 

            localStorage.setItem('listaRemedios', JSON.stringify(remedios));
            
            const itemElement = document.getElementById(`remedio-${id}`);
            if (itemElement) {
                if (checkbox.checked) {
                    itemElement.classList.add('tomado');
                } else {
                    itemElement.classList.remove('tomado');
                }
            }
            
            verificarRemediosAtrasados();
            carregarRemedios(); 
            if(document.getElementById('tela-atrasos').classList.contains('ativa')) {
                carregarRemediosAtrasados();
            }
        }
    }


    function carregarRemediosAtrasados() {
        const remedios = JSON.parse(localStorage.getItem('listaRemedios') || '[]');
        const atrasosContainer = document.getElementById('lista-atrasos-container');
        const agora = new Date();
        
        const remediosAtrasados = remedios.filter(remedio => {
            const proximaDose = new Date(remedio.proximaDose);
            const passouDoHorario = proximaDose < agora;
            return passouDoHorario && !remedio.tomado;
        }).sort((a, b) => new Date(a.proximaDose) - new Date(b.proximaDose)); 

        atrasosContainer.innerHTML = ''; 
        
        if (remediosAtrasados.length === 0) {
            atrasosContainer.innerHTML = '<p style="font-style: italic; color: var(--cor-sucesso); font-weight: bold;">Nenhum rem√©dio em atraso. Tudo em dia! üéâ</p>';
            return;
        }

        remediosAtrasados.forEach(remedio => {
            const proximaDoseFormatada = new Date(remedio.proximaDose).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            const div = document.createElement('div');
            div.className = 'lista-item'; 
            div.style.borderLeft = '5px solid var(--cor-atraso)'; 
            
            div.innerHTML = `
                <div class="lista-item-content" style="flex-grow: 1; display: block;">
                    <strong>${remedio.nome}</strong>
                    <span style="color: var(--cor-atraso); font-weight: bold;">
                        Dose de ${proximaDoseFormatada} (a cada ${remedio.intervalo}h) - ATRASADA
                    </span>
                </div>
                <button 
                    onclick="navegarPara('tela-remedios')" 
                    class="btn"
                    style="width: auto; padding: 10px 15px; margin: 0; background-color: var(--cor-secundaria); font-size: 1rem;"
                >Marcar como Tomado</button>
            `;
            atrasosContainer.appendChild(div);
        });
    }

    function carregarRemedios() {
        const remedios = JSON.parse(localStorage.getItem('listaRemedios') || '[]');
        listaRemediosContainer.innerHTML = ''; 
        
        Object.keys(timersNotificacao).forEach(id => clearTimeout(timersNotificacao[id])); 

        if (remedios.length === 0) {
            listaRemediosContainer.innerHTML = '<p style="font-style: italic; color: #666;">Nenhum rem√©dio cadastrado ainda.</p>';
            return;
        }

        remedios.sort((a, b) => new Date(a.proximaDose) - new Date(b.proximaDose)); 

        remedios.forEach(remedio => {
            agendarNotificacao(remedio); 
            
            const proximaDoseFormatada = new Date(remedio.proximaDose).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const div = document.createElement('div');
            let isDoseAtrasada = new Date(remedio.proximaDose) < new Date() && !remedio.tomado;
            let bordaEstilo = isDoseAtrasada ? 'border-left: 5px solid var(--cor-atraso);' : '';
            
            div.className = `lista-item ${!isDoseAtrasada && remedio.tomado ? 'tomado' : ''}`;
            div.id = `remedio-${remedio.id}`; 
            div.style.cssText = bordaEstilo;

            let isChecked = !isDoseAtrasada && remedio.tomado;

            div.innerHTML = `
                <div class="lista-item-content">
                    <input 
                        type="checkbox" 
                        class="checkbox-grande" 
                        ${isChecked ? 'checked' : ''} 
                        onchange="marcarComoTomado(${remedio.id}, this)"
                        aria-label="Marcar ${remedio.nome} como tomado"
                    >
                    <div>
                        <strong>${remedio.nome}</strong>
                        <span>
                            Pr√≥xima Dose: ${proximaDoseFormatada} (a cada ${remedio.intervalo}h)
                        </span>
                    </div>
                </div>
                <button 
                    onclick="removerRemedio(${remedio.id})" 
                    class="btn btn-remover"
                    aria-label="Remover Rem√©dio ${remedio.nome}"
                >Remover</button>
            `;
            listaRemediosContainer.appendChild(div);
        });
        
        verificarRemediosAtrasados();
    }

    function removerRemedio(id) {
        if(confirm('Deseja realmente excluir este rem√©dio?')) {
            clearTimeout(timersNotificacao[id]); 
            delete timersNotificacao[id]; 
            
            let remedios = JSON.parse(localStorage.getItem('listaRemedios') || '[]');
            remedios = remedios.filter(r => r.id !== id);
            localStorage.setItem('listaRemedios', JSON.stringify(remedios));
            
            carregarRemedios();
            verificarRemediosAtrasados();
            if(document.getElementById('tela-atrasos').classList.contains('ativa')) {
                carregarRemediosAtrasados();
            }
        }
    }
</script>

</body>
</html>
